version: 2

models:
  - name: Bridge_Questions_Tag
    description: "{{ doc('Bridge_Questions_Tag') }}"
    meta:
      owner: Christopher Lewis
      domain: stack_overflow
      layer: gold
      maturity: medium

    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - question_id
              - tag_id

    columns:
      - name: question_id
        description: "Question identifier from `Silver_Layer_Questions`."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('Silver_Layer_Questions')
                field: question_id

      - name: tag_id
        description: "Deterministic STRING surrogate key from `Dimensions_Tags` (to_hex(md5(lower(trim(tag)))))."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('Dimensions_Tags')
                field: tag_id
          - dbt_utils.expression_is_true:
              expression: "regexp_contains(tag_id, r'^[0-9a-f]{32}$')"
